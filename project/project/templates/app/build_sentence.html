{% extends 'app/question_mode.html' %}
{% block card_title%}Übersetzen den Satz!{% endblock%}


{% block card %}
"{{ sentence }}"
<p id="sentence-container">

    {% for word in words %}
      <button type="button" class="word-button" data-word="{{ word }}">
        {{ word }}
      </button>
    {% endfor %}
  </p>
  <hr>
  <p id="selected-words"></p>
  <button type="button" id="submit-button">Satz überprüfen</button>
{% endblock %}








{% block scripts %}
<script>
    const sentenceContainer = document.getElementById('sentence-container');
    const selectedWordsContainer = document.getElementById('selected-words');
    const submitButton = document.getElementById('submit-button');
    const wordButtons = document.querySelectorAll('.word-button');
    const selectedWords = [];

    wordButtons.forEach(button => {
      button.addEventListener('click', function() {
        const word = button.getAttribute('data-word');
        selectedWords.push(word);
        button.style.display = 'none';  
        updateSelectedWords();
      });
    });

    submitButton.addEventListener('click', function() {
      const csrfToken = document.getElementsByName('csrfmiddlewaretoken')[0].value;

      fetch('', { 
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': csrfToken,
        },
        body: JSON.stringify({ sentence: selectedWords }),
      })
      .then(response => response.json())
      .then(data => {
        alert(data.message);  // Anzeige einer einfachen Nachricht vom Backend
      })
      .catch(error => console.error('Error:', error));
    });

    function updateSelectedWords() {
      selectedWordsContainer.innerHTML = selectedWords.map(word => `
        <button type="button" class="selected-word-button" data-word="${word}">
          ${word}
        </button>
      `).join(' ');

      const selectedWordButtons = document.querySelectorAll('.selected-word-button');
      selectedWordButtons.forEach(selectedWordButton => {
        selectedWordButton.addEventListener('click', function(event) {
          const wordToRemove = selectedWordButton.getAttribute('data-word');
          selectedWords.splice(selectedWords.indexOf(wordToRemove), 1);
          updateSelectedWords();
          showWordInList(wordToRemove);
        });
      });
    }

    function showWordInList(word) {
      const index = Array.from(wordButtons).findIndex(button => button.getAttribute('data-word') === word);
      if (index !== -1) {
        wordButtons[index].style.display = 'inline-block';
      }
    }
  </script>

{% endblock %}













 {% comment  %}
 
 <p>

    {{ sentence_de }}<br>
    <form hx-post="{% url 'push_word' %}" hx-target='#htmx-area' class="d-flex align-items-center" method="POST">
    <hr>
    <div id="htmx-area">
    {% for word in words %}
    <button type="button" class="btn btn-outline-secondary" hx-post="{% url 'push_word' %}" hx-target="#htmx-area" hx-include="#htmx-area">{{ word }}</button>
     {% endfor %}
     <div>
    </form
    </p>
    
 {% endcomment %}}